SELECT
    cf.patient_id,
    cf.facility_id,
    LISTAGG(rf.display_value, ', ')
        WITHIN GROUP (ORDER BY rf.display_value) AS race
FROM rpt_case_fact cf
JOIN rpt_report_fact rf
  ON cf.calculation_id = rf.calculation_id
WHERE UPPER(TRIM(rf.sub_category)) = 'RACE'
  AND rf.display_value IS NOT NULL
GROUP BY cf.patient_id, cf.facility_id
ORDER BY cf.patient_id;