SELECT
    cf.patient_id,
    cf.patient_name,
    cf.facility_id,
    LISTAGG(CASE WHEN UPPER(TRIM(rf.sub_category)) = 'RACE'   THEN rf.display_value END, ', ')
        WITHIN GROUP (ORDER BY rf.display_value) AS race,
    LISTAGG(CASE WHEN UPPER(TRIM(rf.sub_category)) = 'AGE'    THEN rf.display_value END, ', ')
        WITHIN GROUP (ORDER BY rf.display_value) AS age,
    LISTAGG(CASE WHEN UPPER(TRIM(rf.sub_category)) = 'GENDER' THEN rf.display_value END, ', ')
        WITHIN GROUP (ORDER BY rf.display_value) AS gender,
    LISTAGG(CASE WHEN UPPER(TRIM(rf.sub_category)) = 'ETHNICITY' THEN rf.display_value END, ', ')
        WITHIN GROUP (ORDER BY rf.display_value) AS ethnicity
    -- â€¦ repeat for all 100+ subcategories
FROM rpt_case_fact cf
JOIN rpt_report_fact rf
  ON cf.calculation_id = rf.calculation_id
WHERE rf.display_value IS NOT NULL
GROUP BY cf.patient_id, cf.patient_name, cf.facility_id
ORDER BY cf.patient_id;